<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-quickstart/batch-jobs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="STRM Privacy Documentation" href="/opensearch.xml">

<script src="https://plausible.io/js/plausible.js" defer="defer" data-domain="docs.strmprivacy.io"></script><title data-rh="true">Batch Jobs | STRM Privacy Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.strmprivacy.io//docs/latest/quickstart/batch-jobs/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Batch Jobs | STRM Privacy Documentation"><meta data-rh="true" name="description" content="[notebook]//github.com/strmprivacy/demos/blob/main/strmbatchmode_demo.ipynb"><meta data-rh="true" property="og:description" content="[notebook]//github.com/strmprivacy/demos/blob/main/strmbatchmode_demo.ipynb"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://docs.strmprivacy.io//docs/latest/quickstart/batch-jobs/"><link data-rh="true" rel="alternate" href="https://docs.strmprivacy.io//docs/latest/quickstart/batch-jobs/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.strmprivacy.io//docs/latest/quickstart/batch-jobs/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://M24OHV52F0-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.d79a844c.css">
<link rel="preload" href="/assets/js/runtime~main.3857f2a2.js" as="script">
<link rel="preload" href="/assets/js/main.81ce46fb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://strmprivacy.io" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="https://storage.googleapis.com/strm-media/strm-logo-orange-slim.svg" alt="STRM Privacy Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://storage.googleapis.com/strm-media/strm-logo-orange-slim.svg" alt="STRM Privacy Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/latest/overview/about/">Docs</a><a href="https://join.strm.team/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Hiring!</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/latest/overview/">Overview</a><button aria-label="Toggle the collapsible sidebar category &#x27;Overview&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/latest/concepts/">Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/latest/quickstart/">Quickstart</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quickstart&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/quickstart/simple-schema/">Simple Schema</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/latest/quickstart/index-batch/">Batch Processing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Batch Processing&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/latest/quickstart/batch-jobs/">Batch Jobs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/quickstart/batch-exporter/">Batch Exporter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/quickstart/exporting-keys/">Exporting Keys</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/latest/quickstart/index-streaming/">Streaming</a><button aria-label="Toggle the collapsible sidebar category &#x27;Streaming&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/latest/quickstart/ccd/">Customer Cloud Deployments</a><button aria-label="Toggle the collapsible sidebar category &#x27;Customer Cloud Deployments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/quickstart/grpc/">gRPC API definition</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/latest/cli-index/">CLI Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;CLI Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/latest/contact/">Contact</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/latest/quickstart/"><span itemprop="name">Quickstart</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/latest/quickstart/index-batch/"><span itemprop="name">Batch Processing</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Batch Jobs</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Batch Jobs</h1></header><p>We&#x27;re expanding our platform with support for batch processing. Read along, jump right to the <a href="https://github.com/strmprivacy/demos/blob/main/strm_batch_mode_demo.ipynb" target="_blank" rel="noopener noreferrer">the example
notebook</a> or read more about the <a href="/docs/latest/concepts/batch-jobs/">background for batch pipelines</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-strm-batch-mode-pipeline">Create a STRM batch mode pipeline<a class="hash-link" href="#create-a-strm-batch-mode-pipeline" title="Direct link to heading">​</a></h2><p>With batch mode, you can set up data routines that, based on the data contract, grab data from (currently) a bucket,
transform according to a data contract and subsequently pick it up for downstream processing.</p><p>This is a powerful way to quickly set up data pipelines to feed applications that process or need sensitive data in
batch routines without the overhead. In the real-world this means you align on the privacy implications with your
security and/or legal counterparts first, and because privacy comes by design and is encoded into the pipeline AND data
itself, you can just go ahead and build a bunch.</p><p>This saves you a lot of trips to legal desks, and so improves your quality of life considerably.</p><p>(we&#x27;re joking - it just means you can build faster).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="on-the-menu">On the menu<a class="hash-link" href="#on-the-menu" title="Direct link to heading">​</a></h3><p>These are the steps we will walk through today:</p><ul><li>Create a data connection to retrieve and store the data</li><li>Define the data contract your data adheres to.</li><li>Define a batch job in the CLI</li><li>Generate some data for demo purposes</li><li>Explore the transformed data for downstream consumption</li></ul><p>Let&#x27;s go!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-data-connection">Create a data connection<a class="hash-link" href="#create-a-data-connection" title="Direct link to heading">​</a></h3><p>The first step is to create a data connection to read and write your (privacy transformed) data.</p><p>You can reuse an existing data-connector you have defined already, or define a new one quickly via either console or CLI:</p><p><code>strm create data-connector --credentials-file yourcredsfile.json --data-connector-type S3</code></p><p>In the console it&#x27;s behind the <code>data-connector</code> menu tab:</p><p><img loading="lazy" alt="create data-connector in console" src="/assets/images/create-sink-24a4f4494d1d1d0f2ab0090e73ad6442.png" width="1774" height="1126" class="img_ev3q"></p><p>This early release supports AWS S3 data-connectors. <a href="/docs/latest/quickstart/batch-exporter/">Head over to the docs</a> for more detail on
creating and managing data-connectors.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-data-contract">Define the data contract<a class="hash-link" href="#define-the-data-contract" title="Direct link to heading">​</a></h3><p>The next step is to instruct us what your data looks like. This is done in the <em>data contract</em>, which combines the data
shape (your fields) with the privacy implications.</p><p>These are the shape and classification for the <a href="https://strmprivacy.io/schemas/strmprivacy/example/1.3.0/" target="_blank" rel="noopener noreferrer">privacy demo event
contract</a>:</p><p><em>Data shape</em>
<img loading="lazy" alt="a defined data schema" src="/assets/images/schema-example-fde3831236ae69e2390348afca5f6ec3.png" width="1912" height="624" class="img_ev3q"></p><p><em>Data classification</em>
<img loading="lazy" alt="define the privacy implications" src="/assets/images/event-contract-541986a0193832ed757e7dc64f48c0a5.png" width="1860" height="734" class="img_ev3q"></p><p>You can use an existing data contract or create your own. Refer to this blog on <a href="https://strmprivacy.io/posts/add-your-own-schemas/" target="_blank" rel="noopener noreferrer">creating data
contracts</a>. We also offer what we call <a href="https://strmprivacy.io/posts/simple-data-schemas/" target="_blank" rel="noopener noreferrer">Simple
Schemas</a>, a much easier way to define your data shape than the
underlying AVRO serialization schema.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-a-batch-job-in-the-cli">Define a batch job in the CLI.<a class="hash-link" href="#define-a-batch-job-in-the-cli" title="Direct link to heading">​</a></h3><p>With the data connection and contract defined, we can now define the batch job itself.</p><p>In this early release this is done by providing a config JSON through our CLI:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❯ strm create batch-job --help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Create a Batch Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  strm create batch-job </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">flags</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -F, --file stringThe path to the JSON </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> containing the batch job configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -h, --help </span><span class="token builtin class-name">help</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> batch-job</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The JSON simply details which data-connector to use, what contract to apply and how to write the data back. We are
working to include GCP Storage, a visual interface and even a file upload in follow-on releases.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="indicate-the-consent-field">Indicate the consent field<a class="hash-link" href="#indicate-the-consent-field" title="Direct link to heading">​</a></h4><p>An important part of the definition file is the consent mapping.</p><p>In streaming mode, you simply send us the consent (legal ground under which the data was collected) as part of every event.</p><p>For batch mode you need to indicate which field in your data actually contains the legal ground per row.</p><p>In the definition file you need to set these three values:</p><ul><li>what the default legal ground (consent level) is.</li><li>the field that contains the legal ground in your data and</li><li>what each of these fields mean (a mapping of name to integer values)</li></ul><p>About the default consent: It&#x27;s safest to keep this to int 0. It just means the data was collected under the most basic
consent or legal ground you use.</p><div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // partial excerpt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;consent&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;default_consent_levels&quot;: [ 0 ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;consent_level_extractor&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;field&quot;: &quot;the field that indicates collection ground&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;field_patterns&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;example, like legitimate interest&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;consent_levels&quot;: [ 1 ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;example, like marketing&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;consent_levels&quot;: [ 2 ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // partial excerpt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://github.com/strmprivacy/demos/blob/main/strm_batch_mode_demo.ipynb" target="_blank" rel="noopener noreferrer">An example of the full definition file is included in the demo
notebook</a>. Just swap the example values for
your own billing_id, data-connector names and preferred buckets.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-derived-data">Define the derived data<a class="hash-link" href="#define-the-derived-data" title="Direct link to heading">​</a></h3><p>The next step is to define the derived data - the privacy-transformed output. Just think of this as a folder on a disk
that contains data that is ready for a specific purpose (like, in the example below, training a recommender).</p><p>First, let&#x27;s dive a bit deeper into how we transform. For reasons of the tutorial, we&#x27;ll focus on a specific derived
stream - in real-world applications you would probably have many different consent levels (the legal ground under which
data is collected) and so a bunch of different derived streams.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="intermezzo-privacy-transforming-your-data">Intermezzo: Privacy-transforming your data<a class="hash-link" href="#intermezzo-privacy-transforming-your-data" title="Direct link to heading">​</a></h4><p>Based on the event-contract, we process and transform the data in your batches. The level of privacy we can achieve
depends on the format of your source data.</p><p>Let us explain:</p><p>We use the temporal dimension in data to achieve a fast but powerful way to apply the necessary transformations (through
the <code>keyField</code> in the event contract) through encryption. It is therefore important to understand that data is
pseudonimized at best unless you have multiple rows per user that are closely spaced in time (like separated clicks or
url hits with context data).</p><p>We plan to extend the privacy transforms soon, but as we expand into batch mode from streaming mode (where you usually
have separate but closely spaced data points - e.g. events over multiple days) this is currently an important
limitation.</p><p>So are you planning to use batch mode for e.g. user profile info, where every row is just one user? That won&#x27;t get you
anonymized data currently!</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="a-real-world-case-for-derived-data-masking-for-recommenders">A real-world case for derived data: masking for recommenders<a class="hash-link" href="#a-real-world-case-for-derived-data-masking-for-recommenders" title="Direct link to heading">​</a></h4><p>Back to a real-world case. Imagine you have a batch job with clickstream data you plan to use to train or evaluate a recommender system.</p><p>Your data includes a pii field that you do not want or are not allowed to reveal, while you do need it for your data
analysis. Recommendations are highly personal and therefore require linking previous behaviour (orders, movies etc.) to
the same user.</p><p>The only &quot;personality dimension&quot; a basic recommender really needs is to know what was the same user. They do not
necessarily need to know who was the underlying customer. This is where masking comes in.</p><p>By masking a field, we replace the actual value (e.g. the customer id) with a hash, allowing to link multiple data
points to a single user, without revealing personal information. This can be done with derived streams.</p><p>In the snippet below, you will find the <code>derived_data</code> configuration of the batch-job. This configuration shows the
data-connector to read <em>from</em>, the file to write <em>to</em> and the allowed consent levels and consent type of the data like
before. Finally, the snippet also shows the <code>masked_fields</code>. Within the event-contract block
<code>&quot;databert-handle/batch_job_public/1.0.1&quot;{ ... }</code> you can find the column names or <code>field_patterns</code> of the fields to
mask.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// partial excerpt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;derived_data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;target&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;data_connector_ref&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;billing_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;your_billing_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;databert-demo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;data_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;csv&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;charset&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;UTF-8&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;file_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;databert-demo-derived.csv&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;consent_levels&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;consent_level_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CUMULATIVE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;masked_fields&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;field_patterns&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;databert-handle/batch_job_public/1.0.0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;field_patterns&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&quot;Email&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&quot;UserName&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// partial excerpt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="generate-the-batch-data">Generate the batch data<a class="hash-link" href="#generate-the-batch-data" title="Direct link to heading">​</a></h3><p>In a batch job, data is read, transformed and returned as soon as new files are found inside the bucket.</p><p>To simulate a data routine you already have or plan to set up, the <a href="https://github.com/strmprivacy/demos/blob/main/strm_batch_mode_demo.ipynb" target="_blank" rel="noopener noreferrer">example notebook</a> includes a
<code>DataGenerator</code> class that simulates some random user data (when we say random, we really mean &quot;non-sensical&quot;).  Apart
from session, user and meta (like a timestamp) fields you will recognize the <code>PrivacyPlane</code> as the consent field in step
3.1 above.</p><p>Clone/fork/download the notebook and add/replace your own <code>billing_id</code> and credentials in the <code>AwsProperties()</code> class
and <code>s3.json</code> to quickly prepare a demo pipeline of your own.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="explore-privacy-transformed-data">Explore privacy-transformed data<a class="hash-link" href="#explore-privacy-transformed-data" title="Direct link to heading">​</a></h3><p>We have now defined the data shape and privacy implications (the <code>data contract</code>), defined the <code>batch job</code>, created a
<code>derived stream</code> with masking applied, and generated some example data.</p><p>Let&#x27;s explore what happens to the data based on (1) the event contract and (2) derived stream we defined.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="input-data">Input data<a class="hash-link" href="#input-data" title="Direct link to heading">​</a></h4><p>The input data coming from the <code>DataGenerator</code> class that acts as input won&#x27;t surprise you:</p><p><img loading="lazy" alt="input data" src="/assets/images/input-data-914e1107391b4add319bc98b1aaeabd8.png" width="2204" height="908" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="62-encrypted-data">6.2 Encrypted data<a class="hash-link" href="#62-encrypted-data" title="Direct link to heading">​</a></h4><p>The next step is to look at the data that is just encrypted (per field!).</p><p>Basically, all connections that might exist between rows are destroyed here: we see the pii-fields <code>Email</code>,
<code>PrivateFieldA</code> and <code>PrivateFieldB</code>, set in our event contract, are encrypted.</p><p><img loading="lazy" alt="encryped data" src="/assets/images/encrypted-data-d1a3da61db712c530acb3f6356bb4468.png" width="2234" height="1204" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="derived-data">Derived Data<a class="hash-link" href="#derived-data" title="Direct link to heading">​</a></h4><p>It becomes more interesting when we take a look at the derived data (as we defined the derived stream above). Remember,
the goal was to apply masking instead of destroying any connection between rows that might exist.</p><p>Per the event contract, the derived data is allowed to contain entries with a consent level of 2 or higher. From the
input data we know that there are 3 entries with a consent level of 2, which correspond to the three outputs below. In
the table you can also see that the values for <code>UserName</code> and <code>Email</code> are hashed. This corresponds to the
<code>field_patterns</code> that we have set in de <code>masked_fields</code> section of the event contract for <code>derived_data</code>. The username
has been masked, but the hashed username is consistent over all rows. The <code>Email</code> field is different for every entry and
therefore the hashed field is too.</p><p><img loading="lazy" alt="derived data" src="/assets/images/derived-data-588090b5f778a21b7f44d067ef593210.png" width="2210" height="396" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-notebook">Example notebook<a class="hash-link" href="#example-notebook" title="Direct link to heading">​</a></h3><p>To quickly see for yourself how Batch Mode works, copy or clone the example notebook from Github with your own S3 and
STRM credentials and explore the data. It also includes the batch job definition file.</p><p><a href="https://github.com/strmprivacy/demos/blob/main/strm_batch_mode_demo.ipynb" target="_blank" rel="noopener noreferrer">Get it</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="in-sum-strm-batch-mode">In sum: STRM Batch mode<a class="hash-link" href="#in-sum-strm-batch-mode" title="Direct link to heading">​</a></h3><p>So, to illustrate how to create batch jobs with privacy transformations, we took the following steps:</p><ul><li>We created a data connection to retrieve and store the data</li><li>Defined the data contract your data adheres to.</li><li>We defined a batch job in the CLI</li><li>Generated some data for demo purposes</li><li>Explore the transformed data for downstream consumption</li></ul><p><a href="https://accounts.strmprivacy.io/auth/realms/users/protocol/openid-connect/registrations?client_id=console&amp;response_type=code&amp;scope=openid%20email&amp;redirect_uri=https://console.strmprivacy.io/" target="_blank" rel="noopener noreferrer">Sign-up</a> to try if for yourself and let us know how we can help you!</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/latest/quickstart/index-batch/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Quickstart Batch processing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/latest/quickstart/batch-exporter/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Batch Exporter</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-a-strm-batch-mode-pipeline" class="table-of-contents__link toc-highlight">Create a STRM batch mode pipeline</a><ul><li><a href="#on-the-menu" class="table-of-contents__link toc-highlight">On the menu</a></li><li><a href="#create-a-data-connection" class="table-of-contents__link toc-highlight">Create a data connection</a></li><li><a href="#define-the-data-contract" class="table-of-contents__link toc-highlight">Define the data contract</a></li><li><a href="#define-a-batch-job-in-the-cli" class="table-of-contents__link toc-highlight">Define a batch job in the CLI.</a></li><li><a href="#define-the-derived-data" class="table-of-contents__link toc-highlight">Define the derived data</a></li><li><a href="#generate-the-batch-data" class="table-of-contents__link toc-highlight">Generate the batch data</a></li><li><a href="#explore-privacy-transformed-data" class="table-of-contents__link toc-highlight">Explore privacy-transformed data</a></li><li><a href="#example-notebook" class="table-of-contents__link toc-highlight">Example notebook</a></li><li><a href="#in-sum-strm-batch-mode" class="table-of-contents__link toc-highlight">In sum: STRM Batch mode</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright (C) 2020-2022 STRM Privacy</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3857f2a2.js"></script>
<script src="/assets/js/main.81ce46fb.js"></script>
</body>
</html>