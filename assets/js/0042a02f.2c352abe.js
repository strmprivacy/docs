"use strict";(self.webpackChunkend_user_docs=self.webpackChunkend_user_docs||[]).push([[6767],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>d});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=p(a),d=r,h=m["".concat(s,".").concat(d)]||m[d]||c[d]||l;return a?n.createElement(h,i(i({ref:t},u),{},{components:a})):n.createElement(h,i({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(7294),r=a(6010);const l="tabItem_Ymn6";function i(e){let{children:t,hidden:a,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(l,i),hidden:a},t)}},5488:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(7462),r=a(7294),l=a(6010),i=a(2389),o=a(7392),s=a(7094),p=a(2466);const u="tabList__CuJ",c="tabItem_LNqP";function m(e){var t,a;const{lazy:i,block:m,defaultValue:d,values:h,groupId:g,className:k}=e,v=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=h?h:v.map((e=>{let{props:{value:t,label:a,attributes:n}}=e;return{value:t,label:a,attributes:n}})),y=(0,o.l)(f,((e,t)=>e.value===t.value));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const b=null===d?d:null!=(t=null!=d?d:null==(a=v.find((e=>e.props.default)))?void 0:a.props.value)?t:v[0].props.value;if(null!==b&&!f.some((e=>e.value===b)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+f.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:N,setTabGroupChoices:C}=(0,s.U)(),[w,T]=(0,r.useState)(b),x=[],{blockElementScrollPositionUntilNextRender:E}=(0,p.o5)();if(null!=g){const e=N[g];null!=e&&e!==w&&f.some((t=>t.value===e))&&T(e)}const O=e=>{const t=e.currentTarget,a=x.indexOf(t),n=f[a].value;n!==w&&(E(t),T(n),null!=g&&C(g,String(n)))},P=e=>{var t;let a=null;switch(e.key){case"ArrowRight":{var n;const t=x.indexOf(e.currentTarget)+1;a=null!=(n=x[t])?n:x[0];break}case"ArrowLeft":{var r;const t=x.indexOf(e.currentTarget)-1;a=null!=(r=x[t])?r:x[x.length-1];break}}null==(t=a)||t.focus()};return r.createElement("div",{className:(0,l.Z)("tabs-container",u)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":m},k)},f.map((e=>{let{value:t,label:a,attributes:i}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>x.push(e),onKeyDown:P,onFocus:O,onClick:O},i,{className:(0,l.Z)("tabs__item",c,null==i?void 0:i.className,{"tabs__item--active":w===t})}),null!=a?a:t)}))),i?(0,r.cloneElement)(v.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},v.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function d(e){const t=(0,i.Z)();return r.createElement(m,(0,n.Z)({key:String(t)},e))}},3800:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>p,toc:()=>c});var n=a(7462),r=(a(7294),a(3905)),l=a(5488),i=a(5162);const o={title:"Upgrading",hide_table_of_contents:!1},s=void 0,p={unversionedId:"quickstart/ccd/updating",id:"quickstart/ccd/updating",title:"Upgrading",description:"Upgrading to a new version can be done easily using Helm. The process on a high level is composed of the following",source:"@site/docs/03-quickstart/04-ccd/99-updating.md",sourceDirName:"03-quickstart/04-ccd",slug:"/quickstart/ccd/updating",permalink:"/docs/latest/quickstart/ccd/updating",draft:!1,tags:[],version:"current",sidebarPosition:99,frontMatter:{title:"Upgrading",hide_table_of_contents:!1},sidebar:"docs",previous:{title:"Authenticated Kafka",permalink:"/docs/latest/quickstart/ccd/authenticated"},next:{title:"Authentication via the CLI",permalink:"/docs/latest/quickstart/authentication-cli"}},u={},c=[{value:"Upgrade instructions",id:"upgrade-instructions",level:2},{value:"Verifying cluster and namespace",id:"verifying-cluster-and-namespace",level:3},{value:"View the current deployment",id:"view-the-current-deployment",level:3},{value:"Upgrade the Helm Chart",id:"upgrade-the-helm-chart",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Migration guides",id:"migration-guides",level:2},{value:"Migrating to 1.15.0",id:"migrating-to-1150",level:3}],m={toc:c};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Upgrading to a new version can be done easily using Helm. The process on a high level is composed of the following\nsteps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Check the ",(0,r.kt)("a",{parentName:"li",href:"#migration-guides"},"migration guides below")),(0,r.kt)("li",{parentName:"ol"},"Determine whether you need to make required changes before upgrading"),(0,r.kt)("li",{parentName:"ol"},"When upgrading multiple versions at once, determine whether smaller version increments are required"),(0,r.kt)("li",{parentName:"ol"},"Follow the ",(0,r.kt)("a",{parentName:"li",href:"#upgrade-commands"},"upgrade commands"))),(0,r.kt)("h2",{id:"upgrade-instructions"},"Upgrade instructions"),(0,r.kt)("p",null,"This section assumes that you are able to connect to your Kubernetes cluster and have the appropriate access rights\nto upgrade the Helm Chart. Furthermore, this also assumes that you have followed\nthe ",(0,r.kt)("a",{parentName:"p",href:"/docs/latest/quickstart/ccd/pre-requisites"},"pre-requisites")," section and have installed the tools mentioned\nthere."),(0,r.kt)("h3",{id:"verifying-cluster-and-namespace"},"Verifying cluster and namespace"),(0,r.kt)("p",null,"First, make sure you're connected to the correct cluster and namespace:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl config current-context\nkubernetes-dev\n\n$ kubectl config view --minify -o jsonpath='{..namespace}'\nnot-the-correct-namespace\n")),(0,r.kt)("p",null,"If not connected to the correct context or namespace, use:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl config use-context kubernetes-dev\n$ kubectl config set-context --current --namespace=strmprivacy\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The easy way to do this is using ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectx")," (without args shows current and other contexts) and ",(0,r.kt)("inlineCode",{parentName:"p"},"kubens")," (without args\nshows current and other namespaces)")),(0,r.kt)("h3",{id:"view-the-current-deployment"},"View the current deployment"),(0,r.kt)("p",null,"To list the currently deployed Helm Chart, execute the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm list\n\nNAME                   NAMESPACE    REVISION    UPDATED                                 STATUS      CHART       APP VERSION\nstrmprivacy-data-plane strmprivacy  1           2022-09-06 13:36:55.521427 +0200 CEST   deployed    strm-1.15.0 1.16.0\n")),(0,r.kt)("p",null,"As the Kubernetes context and namespace just have been set to the namespace of your Data Plane Helm Chart deployment,\nit only lists the Helm Charts deployed to this namespace. As you can see, the chart version is ",(0,r.kt)("inlineCode",{parentName:"p"},"1.15.0")," here in this\nexample."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"From chart version 1.16.0, the ",(0,r.kt)("inlineCode",{parentName:"p"},"appVersion")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"version"),"\nin ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/strmprivacy/data-plane-helm-chart/blob/master/helm/Chart.yaml"},(0,r.kt)("inlineCode",{parentName:"a"},"Chart.yaml"))," are identical. For\nversions < 1.16.0, the ",(0,r.kt)("inlineCode",{parentName:"p"},"appVersion")," differs from the ",(0,r.kt)("inlineCode",{parentName:"p"},"version"),".")),(0,r.kt)("h3",{id:"upgrade-the-helm-chart"},"Upgrade the Helm Chart"),(0,r.kt)("p",null,"Next, make sure you are able to access the Helm Chart Repository and do the upgrade. This depends on which installation\nmode you have chosen:"),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Omitting the ",(0,r.kt)("inlineCode",{parentName:"p"},"--version")," flag in the ",(0,r.kt)("inlineCode",{parentName:"p"},"helm upgrade")," command results in Helm upgrading to the ",(0,r.kt)("strong",{parentName:"p"},"latest")," version.\nBe cautious, as this may include major version upgrades. Consult the ",(0,r.kt)("a",{parentName:"p",href:"#migration-guides"},"migration guides")," first.")),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"self-hosted",label:"Self-Hosted Installation",mdxType:"TabItem"},(0,r.kt)("p",null,"Ensure you have installed the GCS (Google Cloud Storage is where we host our Helm Chart Repository) plugin for Helm:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm plugin install https://github.com/hayorov/helm-gcs.git\n")),(0,r.kt)("p",null,"Add the Helm Repo if it's not added yet:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm repo add strmrepo gs://stream-machine-production-helm-chart/data-plane\n")),(0,r.kt)("p",null,"Next, upgrade the deployed Helm Chart (assuming that your chart is named ",(0,r.kt)("inlineCode",{parentName:"p"},"strmprivacy-data-plane"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm upgrade strmprivacy-data-plane --namespace strmprivacy strmrepo/strm --values values.yaml\n")),(0,r.kt)("p",null,"Either use a ",(0,r.kt)("inlineCode",{parentName:"p"},"values.yaml")," file (a pre-populated version can be downloaded from the Console, in\nyour ",(0,r.kt)("a",{parentName:"p",href:"https://console.strmprivacy.io"},"installation page"),"), or use the ",(0,r.kt)("inlineCode",{parentName:"p"},"--set")," option to set individual properties.")),(0,r.kt)(i.Z,{value:"aws-marketplace",label:"AWS Marketplace",mdxType:"TabItem"},(0,r.kt)("p",null,"If you have followed the AWS Marketplace installation instructions, you may still have the directory to which the\nprevious\nHelm Chart was downloaded, if so, delete that directory first and recreate it to have a clean working directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ rm -r awsmp-chart\n$ mkdir awsmp-chart && cd awsmp-chart\n")),(0,r.kt)("p",null,"Then, ensure the Helm CLI can access the AWS Marketplace container registry, where the Helm Chart Repository resides:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ aws ecr get-login-password \\\n    --region us-east-1 | helm registry login \\\n    --username AWS \\\n    --password-stdin 709825985650.dkr.ecr.us-east-1.amazonaws.com\n")),(0,r.kt)("p",null,"Pull and untar the Helm Chart (note that the ",(0,r.kt)("inlineCode",{parentName:"p"},"helm pull")," command does not specify a version, keep mind of the ",(0,r.kt)("em",{parentName:"p"},"danger"),"\nblock shown above):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm pull oci://709825985650.dkr.ecr.us-east-1.amazonaws.com/strm-privacy/strm\n$ tar xf $(pwd)/* && find $(pwd) -maxdepth 1 -type f -delete\n")),(0,r.kt)("p",null,"Next, upgrade the deployed Helm Chart (assuming that your chart is named ",(0,r.kt)("inlineCode",{parentName:"p"},"strmprivacy-data-plane"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm upgrade strmprivacy-data-plane --namespace strmprivacy ./* --values values.yaml\n")),(0,r.kt)("p",null,"Either use a ",(0,r.kt)("inlineCode",{parentName:"p"},"values.yaml")," file (a pre-populated version can be downloaded from the Console, in\nyour ",(0,r.kt)("a",{parentName:"p",href:"https://console.strmprivacy.io"},"installation page"),"), or use the ",(0,r.kt)("inlineCode",{parentName:"p"},"--set")," option to set individual properties."))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you wish to upgrade to a specific Helm Chart version of the STRM Privacy Data Plane, use the ",(0,r.kt)("inlineCode",{parentName:"p"},"--version 1.10.0")," flag\nto upgrade to a specific version (",(0,r.kt)("inlineCode",{parentName:"p"},"1.10.0")," in this example).")),(0,r.kt)("p",null,"For more information about Helm and Chart upgrades, please see\nthe ",(0,r.kt)("a",{parentName:"p",href:"https://helm.sh/docs/helm/helm_upgrade/"},"Helm upgrade documentation"),"."),(0,r.kt)("h3",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("p",null,"Running into issues while upgrading? ",(0,r.kt)("a",{parentName:"p",href:"/docs/latest/contact/"},"Contact us")," if you require assistance."),(0,r.kt)("h2",{id:"migration-guides"},"Migration guides"),(0,r.kt)("h3",{id:"migrating-to-1150"},"Migrating to 1.15.0"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Chart changes"),(0,r.kt)("br",{parentName:"p"}),"\n","This release allows to configure Kubernetes Services of type ",(0,r.kt)("inlineCode",{parentName:"p"},"LoadBalancer")," with allowed IP CIDR ranges and\nconfigure the exposed port of the Service."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Application changes"),(0,r.kt)("br",{parentName:"p"}),"\n","The following images are included in this release:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"events/event-gateway"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"v0.71.0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"events/web-socket"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"v1.22.0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"management/entity-agents/batch-jobs-agent"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"v1.17.0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"management/entity-agents/batch-exporters-agent"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"v1.17.0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"management/entity-agents/streams-agent"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"v1.20.0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"management/entity-agents/data-connectors-agent"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"v1.5.0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"management/entity-agents/confluent-schema-proxy"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"v1.2.1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"management/esr-proxy"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"v1.3.0"))))}d.isMDXComponent=!0}}]);