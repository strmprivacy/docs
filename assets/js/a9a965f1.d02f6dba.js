"use strict";(self.webpackChunkend_user_docs=self.webpackChunkend_user_docs||[]).push([[1610],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=c(n),m=r,u=h["".concat(l,".").concat(m)]||h[m]||d[m]||i;return n?a.createElement(u,o(o({ref:t},p),{},{components:n})):a.createElement(u,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6961:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const i={title:"PII Field Encryption",hide_table_of_contents:!1},o=void 0,s={unversionedId:"concepts/data-processing/pii-field-encryption",id:"concepts/data-processing/pii-field-encryption",title:"PII Field Encryption",description:"STRM Privacy aims to protect PII data, by encrypting content specified in event fields,",source:"@site/docs/02-concepts/01-data-processing/01-pii-field-encryption.md",sourceDirName:"02-concepts/01-data-processing",slug:"/concepts/data-processing/pii-field-encryption",permalink:"/docs/latest/concepts/data-processing/pii-field-encryption",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"PII Field Encryption",hide_table_of_contents:!1},sidebar:"docs",previous:{title:"STRM Privacy and your organization",permalink:"/docs/latest/overview/organization"},next:{title:"Batch versus Stream",permalink:"/docs/latest/concepts/data-processing/batch-vs-streaming"}},l={},c=[{value:"Privacy Algorithm",id:"algorithm",level:2},{value:"Field encryption",id:"field-encryption",level:2},{value:"Using the encrypted data",id:"using-the-encrypted-data",level:2},{value:"Using the decrypted data",id:"using-the-decrypted-data",level:2},{value:"Identify the consent levels you need.",id:"identify-the-consent-levels-you-need",level:3},{value:"Consent level types",id:"consent-level-types",level:3},{value:"Create a decrypted stream",id:"create-a-decrypted-stream",level:3}],p={toc:c};function d(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"STRM Privacy aims to protect ",(0,r.kt)("a",{parentName:"p",href:"/docs/latest/overview/pii"},"PII")," data, by encrypting content specified in event fields,\nthat are marked as sensitive in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/latest/concepts/data-contracts/"},"data contract"),"."),(0,r.kt)("h2",{id:"algorithm"},"Privacy Algorithm"),(0,r.kt)("p",null,"The process of encrypting PII data according to the time-based Privacy Algorithm is shown below."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"pii-field-encryption",src:n(5749).Z+"#fullwidth",width:"730",height:"223"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"An event is sent to the STRM Privacy Event Gateway"),(0,r.kt)("li",{parentName:"ol"},"An HTTP Header specifies the reference to the schema that was used to serialize the message. The schema is retrieved\nfrom the Data Contracts API and the message can be deserialized. Next,\nthe ",(0,r.kt)("a",{parentName:"li",href:"/docs/latest/concepts/data-contracts/strm-meta"},(0,r.kt)("inlineCode",{parentName:"a"},"strmMeta")),"\nsection is extracted from the event data."),(0,r.kt)("li",{parentName:"ol"},"The reference to the Data Contract that should be applied to this event is extracted from ",(0,r.kt)("inlineCode",{parentName:"li"},"strmMeta"),"."),(0,r.kt)("li",{parentName:"ol"},"The Data Contract is retrieved and the names of the PII fields and the name of the ",(0,r.kt)("inlineCode",{parentName:"li"},"keyField")," are extracted from the\nData Contract."),(0,r.kt)("li",{parentName:"ol"},"Get an existing / generate a new ",(0,r.kt)("inlineCode",{parentName:"li"},"keyLink")," based on the value in the ",(0,r.kt)("inlineCode",{parentName:"li"},"keyField")," of the event data"),(0,r.kt)("li",{parentName:"ol"},"Encrypt the PII fields using the encryption key"),(0,r.kt)("li",{parentName:"ol"},"After ",(0,r.kt)("strong",{parentName:"li"},"24 hours")," when the ",(0,r.kt)("inlineCode",{parentName:"li"},"keyLink")," and encryption key have been generated, the ",(0,r.kt)("inlineCode",{parentName:"li"},"keyLink")," and the encryption key\nrotate. This is called the ",(0,r.kt)("em",{parentName:"li"},"time-based Privacy Algorithm"),".")),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"As can be seen, the ",(0,r.kt)("inlineCode",{parentName:"p"},"keyLink")," and the ",(0,r.kt)("inlineCode",{parentName:"p"},"keyField")," are closely related, but different.\nRead more about the ",(0,r.kt)("a",{parentName:"p",href:"/docs/latest/concepts/data-contracts/#difference-keyfield-keylink"},"differences here"),".")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If the time-based Privacy Algorithm does not match your needs, please ",(0,r.kt)("a",{parentName:"p",href:"/docs/latest/contact/"},"contact us")," to think of\nother algorithms.")),(0,r.kt)("h2",{id:"field-encryption"},"Field encryption"),(0,r.kt)("p",null,"STRM Privacy uses ",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/tink"},"Google Tink")," as an\nabstraction library for standard ",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/tink/deterministic-aead"},(0,r.kt)("inlineCode",{parentName:"a"},"AES-256")," encryption with a synthetic\ninitialization vector"),". The SIV means that for a certain\nplain-text\nvalue, the corresponding cipher text will be identical (for a certain\nencryption key)."),(0,r.kt)("h2",{id:"using-the-encrypted-data"},"Using the encrypted data"),(0,r.kt)("p",null,"When sending data to STRM Privacy, the PII data fields are encrypted. The resulting\ndata stream is called the ",(0,r.kt)("em",{parentName:"p"},"encrypted stream"),". By design, this data stream does not contain any PII data anymore.\nThis implies that anyone in your company can use it ",(0,r.kt)("sup",{parentName:"p",id:"fnref-1"},(0,r.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")),". In case these data become compromised, you have a business\nissue, but ",(0,r.kt)("strong",{parentName:"p"},"not")," a privacy issue."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The same credentials that are used for sending data to STRM Privacy can be used to consume the encrypted stream")),(0,r.kt)("p",null,"Though the sensitive data are encrypted, these data are still useful. With a typical clickstream, where ",(0,r.kt)("inlineCode",{parentName:"p"},"url")," is\nnot considered personal data, you could identify dead ends on your site,\nor train recommender engines on the encrypted stream, because the\nattributes that identify the sequence even though encrypted, remain ",(0,r.kt)("em",{parentName:"p"},"the\nsame")," for 24 hours",(0,r.kt)("sup",{parentName:"p",id:"fnref-2"},(0,r.kt)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2")),". This is plenty long enough to understand typical\ncustomer journeys, without compromising the privacy of your users."),(0,r.kt)("h2",{id:"using-the-decrypted-data"},"Using the decrypted data"),(0,r.kt)("h3",{id:"identify-the-consent-levels-you-need"},"Identify the consent levels you need."),(0,r.kt)("p",null,"Ask\nthe ",(0,r.kt)("a",{parentName:"p",href:"https://edps.europa.eu/data-protection/data-protection/reference-library/data-protection-officer-dpo_en"},"Data Protection Officer"),"\nthe\nspecific consent levels your use case requires. This will return a list\nof values ",(0,r.kt)("sup",{parentName:"p",id:"fnref-3"},(0,r.kt)("a",{parentName:"sup",href:"#fn-3",className:"footnote-ref"},"3"))," that you need."),(0,r.kt)("h3",{id:"consent-level-types"},"Consent level types"),(0,r.kt)("p",null,"STRM Privacy supports two types of consent levels when creating a\ndecrypted output stream: granular and cumulative."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"Cumulative"),": Only the highest consent level is configured on the\noutput stream. All consent levels from zero (included) up to this\nlevel (included) are decrypted in the output stream.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"Granular"),': All the consent levels that are to be decrypted in the\noutput stream are explicitly configured. This way, it\u2019s possible to\nhave "gaps" between the consent levels. For example, can specify\nlevel 1 and 4, which means that all other levels, including 2 and 3\nremain encrypted.'))),(0,r.kt)("p",null,"The resulting set of consent levels effects two things, see:\n",(0,r.kt)("a",{parentName:"p",href:"#create-a-decrypted-stream"},"Create a decrypted stream")),(0,r.kt)("h3",{id:"create-a-decrypted-stream"},"Create a decrypted stream"),(0,r.kt)("p",null,"Here you instruct STRM Privacy to decrypt event data with corresponding to the requested consent\nlevels, but only for data of which the data subject has provided the required consent. STRM Privacy will:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"exclude all events that don\u2019t at least contain all the consent levels\nyou require from the resulting data stream.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"decrypt attributes with the consent levels you requested. Attributes\nwith other consent levels will not be decrypted. So you receive exactly\nonly those events for which consent was provided, and nothing more."))),(0,r.kt)("p",null,"This means that data consumers will only receive the data they are\nlegally allowed to receive, provided the company is not\nre-using credentials."),(0,r.kt)("div",{className:"footnotes"},(0,r.kt)("hr",{parentName:"div"}),(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol",id:"fn-1"},"at least from a GDPR perspective",(0,r.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-2"},"according to the current time-based privacy algorithm",(0,r.kt)("a",{parentName:"li",href:"#fnref-2",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-3"},"small integers",(0,r.kt)("a",{parentName:"li",href:"#fnref-3",className:"footnote-backref"},"\u21a9")))))}d.isMDXComponent=!0},5749:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pii-field-encryption-491b89fc4e10977c4677c408f3797b6f.svg"}}]);