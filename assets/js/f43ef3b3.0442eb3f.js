"use strict";(self.webpackChunkend_user_docs=self.webpackChunkend_user_docs||[]).push([[7388],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(n),u=r,k=m["".concat(s,".").concat(u)]||m[u]||d[u]||i;return n?a.createElement(k,o(o({ref:t},p),{},{components:n})):a.createElement(k,o({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},546:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],l={title:"Customer Cloud Deployments",hide_table_of_contents:!1},s=void 0,c={unversionedId:"quickstart/ccd",id:"quickstart/ccd",title:"Customer Cloud Deployments",description:"[github]//github.com/strmprivacy/data-plane-helm-chart/tree/master",source:"@site/docs/quickstart/ccd.md",sourceDirName:"quickstart",slug:"/quickstart/ccd",permalink:"/docs/latest/quickstart/ccd",draft:!1,tags:[],version:"current",frontMatter:{title:"Customer Cloud Deployments",hide_table_of_contents:!1},sidebar:"docs",previous:{title:"Simple Schema",permalink:"/docs/latest/quickstart/simple-schema"},next:{title:"STRM Privacy CLI reference",permalink:"/docs/latest/cli-index"}},p={},d=[{value:"Make sure you are on a &#39;Self Hosted&#39; subscription",id:"make-sure-you-are-on-a-self-hosted-subscription",level:2},{value:"Install the following tools",id:"install-the-following-tools",level:2},{value:"Install the STRM customer data plane",id:"install-the-strm-customer-data-plane",level:2},{value:"Preparation",id:"preparation",level:3},{value:"Install the Helm chart",id:"install-the-helm-chart",level:3},{value:"Create in a different namespace",id:"create-in-a-different-namespace",level:3},{value:"Interacting with the CCD cluster",id:"interacting-with-the-ccd-cluster",level:2},{value:"Via telepresence",id:"via-telepresence",level:3},{value:"Sending events with the cli",id:"sending-events-with-the-cli",level:4},{value:"Listening on the web-socket via the cli",id:"listening-on-the-web-socket-via-the-cli",level:4},{value:"Consume from Kafka",id:"consume-from-kafka",level:3},{value:"Exporting to an S3 bucket",id:"exporting-to-an-s3-bucket",level:3},{value:"Python Example",id:"python-example",level:3},{value:"Trying again",id:"trying-again",level:2}],m={toc:d};function u(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This hands-on sessions shows how to get up-and-running with your Customer Cloud Deployment, and verify its\nfunctionality."),(0,i.kt)("h2",{id:"make-sure-you-are-on-a-self-hosted-subscription"},"Make sure you are on a 'Self Hosted' subscription"),(0,i.kt)("p",null,"Your ",(0,i.kt)("a",{parentName:"p",href:"https://console.strmprivacy.io/upgrading"},"STRM profile page"),' should show: "Current subscription: Self hosted". Get in touch with your STRM\nrepresentative if you\'re on a Free or Business subscription.'),(0,i.kt)("p",null,"Once you're on a self hosted subscription, you can proceed with this quickstart guide."),(0,i.kt)("h2",{id:"install-the-following-tools"},"Install the following tools"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"make")," (optional): The Helm repository contains handy ",(0,i.kt)("inlineCode",{parentName:"li"},"make")," targets such as ",(0,i.kt)("em",{parentName:"li"},"install"),", ",(0,i.kt)("em",{parentName:"li"},"upgrade"),", ",(0,i.kt)("em",{parentName:"li"},"wipe"),". None of\nthese are mandatory, one can also execute the commands in the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/strmprivacy/data-plane-helm-chart/blob/master/Makefile"},(0,i.kt)("inlineCode",{parentName:"a"},"Makefile"))," by hand."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/"},(0,i.kt)("inlineCode",{parentName:"a"},"kubectl"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://helm.sh"},(0,i.kt)("inlineCode",{parentName:"a"},"helm"))," (required): This Kubernetes package manager is used for installing (and upgrading) your STRM\ncustomer data plane."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.telepresence.io/"},(0,i.kt)("inlineCode",{parentName:"a"},"telepresence"))," (optional): This tool allows your development computer to become ",(0,i.kt)("em",{parentName:"li"},"part of")," the k8s\ncluster, so that you can directly access k8s services."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/derailed/k9s"},(0,i.kt)("inlineCode",{parentName:"a"},"k9s"))," (optional): This ",(0,i.kt)("em",{parentName:"li"},"textual user interface")," offers a very convenient way to\ninteract with kubernetes clusters."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/ahmetb/kubectx"},(0,i.kt)("inlineCode",{parentName:"a"},"kubectx and kubens"))," (optional): Very useful tools to switch the default\nkubernetes context and namespace.")),(0,i.kt)("h2",{id:"install-the-strm-customer-data-plane"},"Install the STRM customer data plane"),(0,i.kt)("h3",{id:"preparation"},"Preparation"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Make sure you have active kubernetes credentials to a cluster: ",(0,i.kt)("inlineCode",{parentName:"li"},"kubectl get nodes")," should show the nodes of your\ncluster."),(0,i.kt)("li",{parentName:"ol"},"Create a namespace ",(0,i.kt)("inlineCode",{parentName:"li"},"strmprivacy")," (",(0,i.kt)("inlineCode",{parentName:"li"},"kubectl create namespace strmprivacy"),") and set that as default (",(0,i.kt)("inlineCode",{parentName:"li"},"kubens strmprivacy"),")."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"git clone https://github.com/strmprivacy/data-plane-helm-chart.git"),". In the near future this will become part of a\nHelm repository, and this command will become ",(0,i.kt)("inlineCode",{parentName:"li"},"helm repo add ..."),"."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"cd data-plane-helm-chart"),"."),(0,i.kt)("li",{parentName:"ol"},"Download the credentials file ",(0,i.kt)("inlineCode",{parentName:"li"},"values.yaml")," through ",(0,i.kt)("a",{parentName:"li",href:"https://console.strmprivacy.io/installation/configuration"},"the STRM Privacy Console")," into the ",(0,i.kt)("inlineCode",{parentName:"li"},"data-plane-helm-chart")," directory.")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"values.yaml")," file should be similar to this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'  registry:\n    imagePullSecret: "ewogIC...."\n\n  license:\n    installationId: "f4cea...."\n    installationClientId: "ins-...."\n    installationClientSecret: "tii...."\n\n  kafka:\n    enabled: true\n\n  redis:\n    enabled: true\n\n  postgresql:\n    enabled: true\n')),(0,i.kt)("h3",{id:"install-the-helm-chart"},"Install the Helm chart"),(0,i.kt)("p",null,"This installs ",(0,i.kt)("em",{parentName:"p"},"all")," the STRM components inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"strmprivacy")," namespace."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"make install")," should be all that is needed. ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl get pods --watch")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"k9s")," provides nice feedback to see how the\ninstallation is progressing. We see that some supporting infrastructure like Redis, Postgresql and Kafka are also\ninstalled. The creation of these components can be disabled, in which case configuration to the actual components will\nhave to be added to the Helm chart."),(0,i.kt)("h3",{id:"create-in-a-different-namespace"},"Create in a different namespace"),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This is still a work in progress, so do not use it yet."))),(0,i.kt)("p",null,"Add ",(0,i.kt)("inlineCode",{parentName:"p"},"namespace=...")," to every ",(0,i.kt)("inlineCode",{parentName:"p"},"make")," command (or modify the ",(0,i.kt)("inlineCode",{parentName:"p"},"Makefile"),")"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"make namespace namespace=mycustomnamespace\nmake install namespace=mycustomnamespace\n")),(0,i.kt)("h2",{id:"interacting-with-the-ccd-cluster"},"Interacting with the CCD cluster"),(0,i.kt)("p",null,"First create two streams."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"strm create stream test --save\nstrm create stream --derived-from test --levels 2 --save\n")),(0,i.kt)("h3",{id:"via-telepresence"},"Via telepresence"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://www.telepresence.io/"},(0,i.kt)("inlineCode",{parentName:"a"},"telepresence"))," is an ",(0,i.kt)("em",{parentName:"p"},"awesome tool")," that brings your development computer via a vpn construction in the\nsame network as your cluster. After you've started the agent (",(0,i.kt)("inlineCode",{parentName:"p"},"telepresence connect"),"), you have direct access to the\nentities in your Kubernetes cluster."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You can also use a port forward instead of telepresence. "))),(0,i.kt)("p",null,"Make sure you set your default namespace via ",(0,i.kt)("inlineCode",{parentName:"p"},"kubens")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"strmprivacy"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl get svc\nNAME                              CLUSTER-IP       PORT(S)\nconfluent-schema-proxy            10.3.174.226     80/TCP\nevent-gateway                     10.3.68.45       80/TCP\nkafka                             10.3.47.1        9092/TCP\nkafka-headless                    None             9092/TCP,9093/TCP\npostgres                          10.3.125.90      5432/TCP\npostgres-hl                       None             5432/TCP\nredis-hallo-headless              None             6379/TCP\nredis-hallo-master                10.3.80.116      6379/TCP\nredis-hallo-replicas              10.3.228.64      6379/TCP\nstrmprivacy-zookeeper             10.3.229.219     2181/TCP,2888/TCP,3888/TCP\nstrmprivacy-zookeeper-headless    None             2181/TCP,2888/TCP,3888/TCP\nweb-socket                        10.3.21.178      80/TCP\n")),(0,i.kt)("p",null,"Because you've create a derived stream (",(0,i.kt)("inlineCode",{parentName:"p"},"test-2"),") we should be able to see a decrypter deployment:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl get deployments.apps  -l app=decrypter-v2\n\nNAME                                             READY   UP-TO-DATE   AVAILABLE   AGE\ndecrypter-a268aea6-4b5b-4241-b833-9a84f4f44bc4   1/1     1            1           93m\n")),(0,i.kt)("p",null,"You could use ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl describe deployment decrypter...")," to see the annotations on the deployment, and see that it is\nindeed processing your ",(0,i.kt)("inlineCode",{parentName:"p"},"test-2")," stream"),(0,i.kt)("h4",{id:"sending-events-with-the-cli"},"Sending events with the cli"),(0,i.kt)("p",null,"To simulate events with our cli, the ",(0,i.kt)("inlineCode",{parentName:"p"},"events-api-url")," paramater must be set to the host exposed via telepresence (the url can also be set in the strm config file (",(0,i.kt)("inlineCode",{parentName:"p"},"strm context config"),")."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"strm simulate random-events test --events-api-url=http://event-gateway.strmprivacy/event --interval 5\nSent 874 events\nSent 1809 events\nSent 2726 events\n...\n")),(0,i.kt)("h4",{id:"listening-on-the-web-socket-via-the-cli"},"Listening on the web-socket via the cli"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'strm listen web-socket test --web-socket-url ws://web-socket.strmprivacy/ws\n\n{"strmMeta": {"eventContractRef": "strmprivacy/example/1.3.0", "nonce": -447993628, "timestamp": 1652181230883, "keyLink": "7573fc76-ae34-4c49-a3fd-d552b677ffa1", "billingId": "strmprodccdtest1908747604", "consentLevels": [0, 1, 2, 3]}, "uniqueIdentifier": "AQAsswoVM2q6Q6+eeTb5Qe61xBHTaAZZMVCh+vDf", "consistentValue": "AQAsswoPYW8+VGwOZvfh+FmSEh2UoVTRNkNWlyQOpwA=", "someSensitiveValue": "AQAsswpQCKDPUYNls3hy13IllL5vd4bz/X3rEsBI0TEV", "notSensitiveValue": "not-sensitive-64"}\n{"strmMeta": {"eventContractRef": "strmprivacy/example/1.3.0", "nonce": -45323834, "timestamp": 1652181230893, "keyLink": "9ced67fc-9227-4fb2-846b-1eed521db941", "billingId": "strmprodccdtest1908747604", "consentLevels": [0, 1, 2]}, "uniqueIdentifier": "AWzkJjeWufjZehXNpWLUQ63CG1O8jxCU6MOd3Seo", "consistentValue": "AWzkJjd3cB+36sCrtT6va3YLjCa5qw55Iy5/HevIcVU=", "someSensitiveValue": "AWzkJjcsrjNHbZCAjlEYCBdlpOVK8+eXIx6BSBDxH8VQ", "notSensitiveValue": "not-sensitive-42"}\n')),(0,i.kt)("p",null,"Or a derived stream"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'strm listen web-socket test-2 --web-socket-url ws://web-socket.strmprivacy/ws\n\n{"strmMeta": {"eventContractRef": "strmprivacy/example/1.3.0", "nonce": -1742873135, "timestamp": 1652181297380, "keyLink": "556c1be7-4332-4058-9d36-5e3e5a66e121", "billingId": "strmprodccdtest1908747604", "consentLevels": [0, 1, 2]}, "uniqueIdentifier": "unique-81", "consistentValue": "session-922", "someSensitiveValue": "AQM0jlnxbeNZSJzvJWLpnMjyYET1Jb1Yz+5yZVB5i6Dq", "notSensitiveValue": "not-sensitive-78"}\n')),(0,i.kt)("h3",{id:"consume-from-kafka"},"Consume from Kafka"),(0,i.kt)("p",null,"Install the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.confluent.io/platform/current/quickstart/ce-docker-quickstart.html#cp-quickstart-step-1"},"Confluent client tools"),". You don't have to start Confluent, you only need to add the ",(0,i.kt)("inlineCode",{parentName:"p"},"bin")," directory\nof the unpacked confluent tar file  to your ",(0,i.kt)("inlineCode",{parentName:"p"},"$PATH"),"."),(0,i.kt)("p",null,"You can determine the input topic of a specific decrypter (provide the full name) as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get deployments.apps decrypter-... -o=jsonpath='{.metadata.annotations.input-topic}'\nstream-a268aea6-4b5b-4241-b833-9a84f4f44bc4\n")),(0,i.kt)("p",null,"Or alternatively, describe the deployment with ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"k9s")," and look up the value of ",(0,i.kt)("inlineCode",{parentName:"p"},"input-topic")," under the annotations."),(0,i.kt)("p",null,"Then pass this topic to the kafka consumer:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'~/Downloads/confluent-7.0.1/bin/kafka-avro-console-consumer \\\n--bootstrap-server kafka.strmprivacy:9092 \\\n--topic stream-a268aea6-4b5b-4241-b833-9a84f4f44bc4 \\\n--property schema.registry.url=http://confluent-schema-proxy.strmprivacy/confluent \\\n--property print.key=true \\\n--key-deserializer="org.apache.kafka.common.serialization.StringDeserializer"\n\n1867d5ad-f1fb-4faa-af98-f863a4f9e3e4    {"strmMeta":{"eventContractRef":"strmprivacy/example/1.3.0","nonce":{"int":-810110116},"timestamp":{"long":1652181101870},"keyLink":{"string":"1867d5ad-f1fb-4faa-af98-f863a4f9e3e4"},"billingId":{"string":"strmprodccdtest1908747604"},"consentLevels":[]},"uniqueIdentifier":{"string":"AR5VVyfQsta+D1XDKcPiR0sC1oE3yy301W2FMVJ9"},"consistentValue":"AR5VVydsWvZG+FkvlOFEUZCvlFY4rSpVHs1njIE8tg==","someSensitiveValue":{"string":"AR5VVyfO8S3djArRlS6ZaI4oefWUjEt9XRnT/f2r6vc="},"notSensitiveValue":{"string":"not-sensitive-84"}}\n5afc9c0a-de67-4e38-bd0a-66640f4349c7    {"strmMeta":{"eventContractRef":"strmprivacy/example/1.3.0","nonce":{"int":1699175479},"timestamp":{"long":1652181101896},"keyLink":{"string":"5afc9c0a-de67-4e38-bd0a-66640f4349c7"},"billingId":{"string":"strmprodccdtest1908747604"},"consentLevels":[0,1,2,3]},"uniqueIdentifier":{"string":"ASotb1YzBuuBBM981rLIzQd/EZA7Em7dxyaBg7vE"},"consistentValue":"ASotb1bYf1G/2ye4h6ELE4hlkVGZGKSt3LQe0AnZU+k=","someSensitiveValue":{"string":"ASotb1bb51OCfM9HdCqcAjTLtXqK67EuBQicTpNzIvv/"},"notSensitiveValue":{"string":"not-sensitive-95"}}\n')),(0,i.kt)("h3",{id:"exporting-to-an-s3-bucket"},"Exporting to an S3 bucket"),(0,i.kt)("p",null,"Create the S3 bucket and the associated ",(0,i.kt)("inlineCode",{parentName:"p"},"data connector"),". See ",(0,i.kt)("a",{parentName:"p",href:"https://docs.strmprivacy.io/docs/latest/quickstart/batch-exporter/#creating-a-data-connector"},"here")," for details\nabout data connector configuration."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"strm create data-connector s3 s3-connector --credentials-file=...\n\nstrm create batch-exporter test-2 --data-connector s3-connector --path-prefix ccd-prod-ovh\n")),(0,i.kt)("p",null,"You should see a newly-created batch-exporter deployment:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl get deployments.apps  -l app=batch-exporter\nNAME                                                  READY   UP-TO-DATE   AVAILABLE   AGE\nbatch-exporter-c726bbff-2b68-4438-ac0d-ee877aa4dabf   1/1     1            1           2m49s\n")),(0,i.kt)("p",null,"If you're sending data, you should see files in your s3 bucket quickly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"aws s3 ls s3://stream-machine-export-demo/ccd-prod-ovh/\n2022-05-10 15:09:21          0 .strm_test_a6c5d566-f851-4778-a7fb-5d39d8958aa4.jsonl\n2022-05-10 15:10:02     131735 2022-05-10T13:10:00-stream-4a35419c-2daf-43ba-8683-7663a0874a35---0-1-2-3-4.jsonl\n2022-05-10 15:11:01     196628 2022-05-10T13:11:00-stream-4a35419c-2daf-43ba-8683-7663a0874a35---0-1-2-3-4.jsonl\n2022-05-10 15:12:01     181281 2022-05-10T13:12:00-stream-4a35419c-2daf-43ba-8683-7663a0874a35---0-1-2-3-4.jsonl\n2022-05-10 15:13:01     202094 2022-05-10T13:13:00-stream-4a35419c-2daf-43ba-8683-7663a0874a35---0-1-2-3-4.jsonl\n")),(0,i.kt)("p",null,"Looking inside one of them:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'aws s3 cp s3://stream-machine-export-demo/ccd-prod-ovh/2022-05-10T13:12:00-stream-4a35419c-2daf-43ba-8683-7663a0874a35---0-1-2-3-4.jsonl - | head -1 | jq\n{\n  "strmMeta": {\n    "eventContractRef": "strmprivacy/example/1.3.0",\n    "nonce": -1616102758,\n    "timestamp": 1652188259519,\n    "keyLink": "9e55c3dc-16a3-422b-91e7-b27dffd385e6",\n    "billingId": "strmprodccdtest1908747604",\n    "consentLevels": [\n      0,\n      1,\n      2\n    ]\n  },\n  "uniqueIdentifier": "unique-3",\n  "consistentValue": "session-453",\n  "someSensitiveValue": "AXWnGm/OjbB42PEJuXLwqZX7sRCdSlLInDpNOnJlBxiJ",\n  "notSensitiveValue": "not-sensitive-6"\n}\n')),(0,i.kt)("h3",{id:"python-example"},"Python Example"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"https://docs.strmprivacy.io/docs/latest/quickstart/full-example/"},"Python example")," needs a small modification in order to work. In the ",(0,i.kt)("inlineCode",{parentName:"p"},"client_builder.py")," file change the\n",(0,i.kt)("inlineCode",{parentName:"p"},"config")," for"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'    config = ClientConfig(log_level=logging.DEBUG,\n                          gateway_protocol="http",\n                          gateway_host="event-gateway.strmprivacy")\n')),(0,i.kt)("h2",{id:"trying-again"},"Trying again"),(0,i.kt)("p",null,"If you've made mistakes and want to start over:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"make uninstall")," cleanly uninstalls the helm release"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"kubectl delete ns strmprivacy")," kills everything (including the k8s namespace). Don't forget to recreate the\nnamespace afterwards.")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"make wipe")," combines the above two steps"))}u.isMDXComponent=!0}}]);